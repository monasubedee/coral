<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>KnowledgeBank</title>
  <link rel='icon' href='/static/ver2.1/img/logo@3x.png' />
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css' />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <link data-require="fontawesome@*" data-semver="4.5.0" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.css" /> -->

  <link rel='stylesheet' href='/static/ver2.1/css/main.css' type='text/css'>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160620961-1"></script>

  {% include './ver2.1/partials/ga_tag.html' %}
</head>
{% include './ver2.1/partials/header.html' %}
{% include './ver2.1/partials/sidebar.html' %}
<div class='kb-alert'>
  <div class='kb-alert-dialog'>
    <div class='kb-alert-panel'>
      <div class='kb-alert-panel__body'>
        <p>ログインしてください</p>
      </div>
      <div class='kb-alert-panel__footer'>
        <button onclick="location.href='/'">ログイン画面へ</button>
      </div>
    </div>
  </div>
</div>
<script>
  var sidebarLink = document.querySelectorAll(".kb-sidebar a");
  sidebarLink.forEach(function (ele) {
    ele.addEventListener("click", function (evt) {
      evt.preventDefault();
      if (localStorage.getItem("ud") && localStorage.getItem("ud") != "")
        window.location.href = $(this).attr("href");
      else {
        document.querySelector(".kb-alert").classList.add("show");
      }
    })
  })
  document.querySelector(".kb-alert button").addEventListener("click", function () {
    document.querySelector(".kb-alert").classList.remove("show");
  })
  var today = new Date()
  var curHr = today.getHours()
  var agree = '';
  if (curHr < 12)
    agree = 'おはようございます！'
  else if (curHr < 18)
    agree = 'こんにちは！'
  else
    agree = 'こんばんは！'

  document.querySelector(".agree").innerText = agree;
  var ud = JSON.parse(localStorage.getItem('ud'));
  document.querySelector(".s-name").innerText = ud.name + 'さん。'
  /* for sidebar highlight */
  var windowURL = window.location.href.split("/");
  var currentURL = '';
  if (windowURL[windowURL.length - 1] == "") {
    currentURL = windowURL[windowURL.length - 2]
  }
  else {
    currentURL = `${windowURL[windowURL.length - 2]}/${windowURL[windowURL.length - 1]}`;
  }
  if (currentURL.match(/\//)) {
    var lowerURL = currentURL.split('/');
    currentURL = lowerURL[0];
  }
  var sidebarLink = document.querySelector(`.kb-sidebar li a[href='/${currentURL}']`);
  if (sidebarLink != null) {
    sidebarLink.closest("li").classList.add("active");
  }
  if (currentURL == "manabu" || currentURL == "question") {
    var headerLink = document.querySelector(`.kb-primary-menuitem a[href='/${currentURL}']`);
    headerLink.closest(".kb-primary-menuitem").classList.add("active");
  }
</script>
<style>
  .display-none {
    display: none !important;
  }

  .tameru-tabs-list span {
    padding: 5px;
    background: #ccc;
    margin: 0px 10px 10px 0px;
    display: inline-block;
    border-radius: .25rem;
  }

  .edit-css {
    display: flex;
    flex-direction: column-reverse;
  }

  .tameru-tabs-list span>label {
    display: inline-block;
    margin-right: 5px;
  }

  .placeholder-css::placeholder {
    color: #d95243;
  }

  .place-css::placeholder {
    color: black;
  }

  .tameru-tabs-list i {
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 1rem;
    text-align: center;
    display: inline-block;
    font-style: normal;
    cursor: pointer;
    background: rgba(0, 0, 0, 0.12);
  }

  .color-err-red {
    color: #d95243;
  }

  .tameru-tabs-list i:hover {
    color: red;
  }

  .uploadArea_wrap {
    width: 236px !important;
    margin: 0 0 0 20px;
    cursor: pointer;
  }

  .uploadArea_wrap_des {
    width: 236px !important;
    margin: 0 0 0 20px;
    cursor: pointer;
  }

  .uploadArea {
    position: relative;
    width: 236px;
    min-height: 126px;
    border-radius: 4px;
    overflow: hidden;
    margin: 0 0 10px;
  }

  .uploadArea_des {
    position: relative;
    width: 236px;
    min-height: 126px;
    border-radius: 4px;
    overflow: hidden;
    margin: 0 0 10px;
  }

  .preview_field img {
    /* position: absolute;
    top: 0;
    left: 0;
    width: 100px;
    height: 100px; */
    width: 100%;
    display: block;
  }

  .create-btn {
    padding-right: 7px;
    display: none;
    color: blue;
  }

  .preview_field_des img {
    width: 100%;
    display: block;
  }

  .drop_area {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: dashed 1px #c9cad0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(55, 57, 67, 0.4);
    font-size: 13px;
  }

  /* .question_edit {
    position: absolute;

  }
  .description_edit{
    position: absolute;
  } */


  .drop_area_des {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: dashed 1px #c9cad0;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(55, 57, 67, 0.4);
    font-size: 13px;
  }

  .img_clear_button {
    display: none;
    position: absolute;
    top: 6px;
    right: 6px;
    width: 20px;
    height: 20px;
    background-color: #8f9091;
    border-radius: 50%;
    cursor: pointer;
  }

  .img_clear_button_des {
    display: none;
    position: absolute;
    top: 6px;
    right: 6px;
    width: 20px;
    height: 20px;
    background-color: #8f9091;
    border-radius: 50%;
    cursor: pointer;
  }

  .img_clear_button:before {
    content: "";
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translateY(-50%) translateX(-50%) rotate(45deg);
    height: 1px;
    width: 10px;
    background-color: #fff;
  }

  .img_clear_button_des:before {
    content: "";
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translateY(-50%) translateX(-50%) rotate(45deg);
    height: 1px;
    width: 10px;
    background-color: #fff;
  }

  .img_clear_button_des:after {
    content: "";
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translateY(-50%) translateX(-50%) rotate(-45deg);
    height: 1px;
    width: 10px;
    background-color: #fff;
  }

  .img_clear_button:after {
    content: "";
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translateY(-50%) translateX(-50%) rotate(-45deg);
    height: 1px;
    width: 10px;
    background-color: #fff;
  }

  .input_file {
    width: 100%;
    height: 100%;
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
  }

  .input_file_des {
    width: 100%;
    height: 100%;
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
  }

  .input_file:focus {
    opacity: 1;
  }

  .wysiwyg-heading {
    width: 100%;
    padding: 4px 10px;
    font-size: 14px;
    margin: 0;
    resize: none;
    border-radius: 0.25rem 0.25rem 0 0;
    border: 1px solid #c9cad0;
    background-color: #fafafa;
    border-bottom: 0;
    line-height: 28px;
  }

  .wysiwyg {
    width: 100%;
    height: 300px;
    padding: 10px;
    font-size: 14px;
    margin: 0;
    resize: none;
    border-radius: 0 0 0.25rem 0.25rem;
    border: 1px solid #c9cad0;
    line-height: 28px;
  }

  .wysiwyg:empty:before {
    content: attr(placeholder);
    pointer-events: none;
    display: block;
    /* For Firefox */
    opacity: 0.4;
  }

  .wysiwyg span {
    position: relative;
    cursor: pointer;
  }

  .wysiwyg span:before {
    content: "";
    position: absolute;
    left: 50%;
    bottom: 100%;
    transform: translateX(-50%);
    border-top: solid 9px #373943;
    border-right: solid 5px transparent;
    border-left: solid 5px transparent;
  }

  .wysiwyg span:after {
    content: "";
    position: absolute;
    left: 50%;
    bottom: calc(100% + 8px);
    transform: translateX(-50%);
    width: 44px;
    height: 40px;
    border-radius: 4px;
    background-color: #373943;
  }

  .wysiwyg .filling {
    display: inline-block;
    position: relative;
    width: auto;
    font-size: 13px;
    border-radius: 4px;
    padding: 0 10px;
    margin: 0 10px 0 5px;
    border: solid 1px #d1d2d8;
    background-color: #fafafa;
    color: #2962ff;
  }

  .filling_delete {
    cursor: pointer;
    position: absolute;
    left: 100%;
    top: -4px;
    transform: translateX(-50%);
    width: 16px;
    height: 16px;
    background-color: #373943;
    border-radius: 50%;
  }

  .filling_delete:before {
    content: "";
    position: absolute;
    display: block;
    height: 1px;
    width: 8px;
    top: 50%;
    left: 50%;
    transform: translateX(-50%) translateY(-50%) rotate(45deg);
    background-color: #fff;
  }

  .kb-tameru-container::-webkit-scrollbar {
    display: none;
  }

  .filling_delete:after {
    content: "";
    position: absolute;
    display: block;
    height: 1px;
    width: 8px;
    top: 50%;
    left: 50%;
    transform: translateX(-50%) translateY(-50%) rotate(-45deg);
    background-color: #fff;
  }


  .filling-toggle {
    display: none;
  }

  .filling-anser {
    display: none;
  }

  .filling {
    color: #d95243;
  }

  .filling-anser-kana {
    display: none;
  }

  .filling-anser-kana input {
    width: 350px !important;
  }

  .heading-required:after {
    content: " *";
    color: #d84f3f;
  }

  .kb-container-loading {
    padding: 20px;
    width: calc(100vw - 220px);
    display: flex;
    justify-content: center;
  }

  .kb-container-loading #loading {
    width: 40px;
    position: fixed;
    top: 50%;
    z-index: 999;
  }
</style>

<body>
  <div>
    <div class='kb-container-loadedAjax'>
      <div class='kb-container kb-tameru-container'>
        <div class='text-center tameru-create-header'>
          <h3>ためる</h3>
          <img src='/static/ver2.1/img/1092@3x.png' alt='' class='kb-tameru-logo my-4' />
        </div>
        <div class="kb-container-loading" style="display: none;">
          <div id='loading'>
            <i class="fa fa-spinner" style="color: blue;font-size: 43px;"></i>
          </div>
        </div>
        <div class='g g-3-1 loading'>
          <div>
            <div class='kb-panel'>
              <div class='kb-panel-title p-3'>
                <p class='m-0'>課題</p>
              </div>
              <div class='kb-panel-body tameru-form px-3'>
                <div class='flex flex-s  my-4 input-required'>
                  <div>
                    <p class='my-2 heading-required'>課題の種別</p>
                  </div>
                  <div>
                    <select class='md form-data question-type-select' data-prop='questionType'>
                      <option value='1' selected>正しいものを１つ選択</option>
                      <option value="2">誤り１つを選択</option>
                      <option value="3">正しいものを全て選択</option>
                      <option value="4">誤ったものを全て選択</option>
                      <option value="5">○ × 式</option>
                      <option value="6">穴埋め式</option>
                    </select>
                  </div>
                </div>
                <div class='flex flex-s my-4 input-required'>
                  <div>
                    <p class="my-2 heading-required">課題内容</p>
                  </div>
                  <div class="question-upload">
                    <div class="questionText-wrap">
                      <div class="questionText-textarea-wrap">
                        <!-- <textarea class='kb-textarea-md form-data problemStatement' data-prop='questionText'></textarea> -->
                        <p class="wysiwyg-heading">
                          正しいものを１つ選びなさい。</p>
                        <div class="kb-textarea-md form-data problemStatement filling-editor wysiwyg"
                          contenteditable="true" id="content_text" placeholder="課題内容を入力してください"></div>
                        <p class="mt-1 mb-0 filling-toggle"><small class="text-muted">穴埋め問題を作るには解答をドラッグして<img src=""
                              alt="">を選択してください。</small></p>
                        <!-- <input type='file' hidden accept='image/*' /> -->
                      </div>
                    </div>
                    <div class="question-upload-preview flex flex-s">
                    </div>
                    <!-- <div class="text-right"><small class="text-muted">登録できる画像は1つのみです。</small></div> -->
                  </div>
                  <div class="uploadArea_wrap" id="questionImg" data-image="1">

                    <div class="uploadArea" id="questionImg-1">
                      <input type="file" name="image" class="input_file" accept="image/*">
                      <div class="preview_field"></div>
                      <div class="drop_area"><i class="far fa-image mr-2"></i>画像を追加</div>
                      <div class="img_clear_button"></div>
                    </div>
                  </div>
                </div>
                <div class='flex flex-s  my-4 input-required'>
                  <div>
                    <p class='my-2 heading-required'>回答</p>
                  </div>
                  <div>
                    <p class="filling-anser my-2 filling-toggle">
                      <span id='filling-error-two' style="display: none;color: #d95243;"></span>
                      <small class="filling-anser-text text-muted" id="blank_text">
                        <span id='filling-error' style="color: #d95243;">回答が入力されていません</span></small>
                    </p>
                    <div class="anser-input">
                      <div class='question-type-media'>
                      </div>
                      <div class="mt-4">
                        <button class='btn-tran add-question-type-media'><i class='fas fa-plus mr-2'></i>回答を追加</button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class='flex flex-s  my-4 input-required filling-anser-kana filling-toggle'>
                  <div>
                    <p class='my-2 heading-required'>回答の読み</p>
                  </div>
                  <div class="filling-anser-kana-input-wrap">
                    <input type='text' id='kana-input'
                      class='kb-input kb-input-md form-data-ans filling-anser-kana-input' data-prop='label'
                      placeholder='回答を書き込んでください' />
                    <p class="mt-1 mb-0"><small class="text-muted">ひらがな・カタカナ・半角英数字で入力してください</small></p>
                  </div>
                </div>
              </div>
            </div>
            <div class='kb-panel my-4'>
              <div class='kb-panel-title p-3'>
                <p class='m-0'>解説</p>
              </div>

              <div class='kb-panel-body tameru-form description-text px-3 input-required'>
                <div class='flex flex-s my-4'>
                  <div>
                    <p class='m-2'>テンプレート</p>
                  </div>
                  <div>
                    <select class='md form-data anser-type-select' data-prop='anserType'>
                      <option value='1' selected>テンプレートを選択する</option>
                      <option value="2">基本テンプレート</option>
                    </select>
                  </div>
                </div>
                <div class='flex flex-s my-4'>
                  <div>
                    <p class='m-2 heading-required'>解説</p>
                  </div>
                  <div class="descriptionText-wrap">
                    <textarea class="form-data descriptionText cmt_msg" data-prop='descriptionText'
                      placeholder="解説を入力してください"></textarea>
                    <textarea hidden class='cmt_msg_hidden' id='hidden_text_data' hidden name='comment_msg_hidden'
                      placeholder="解説を入力してください"></textarea>
                  </div>
                  <div class="uploadArea_wrap_des" id="anserImg" data-image="1">
                    <div class="uploadArea_des" id="anserImg-1">
                      <input type="file" name="image_des" class="input_file_des" accept="image/*">
                      <div class="preview_field_des"></div>
                      <div class="drop_area_des"><i class="far fa-image mr-2"></i>画像を追加</div>
                      <div class="img_clear_button_des"></div>
                    </div>
                  </div>
                </div>
                <div class="description-upload-preview">
                </div>
              </div>
            </div>
            <div class='kb-panel my-4'>
              <div class='kb-panel-title p-3'>
                <p class='m-0'>タグ設定</p>
              </div>
              <div class='kb-panel-body tameru-form assignment-settings px-3'>
                <div class='flex flex-s my-4 input-required-position'
                  style="display: flex;align-items: center;font-size: 14px;">
                  <div class="tags_heading">
                    <p class='m-2 heading-required'>役職タグ</p>
                  </div>
                  <div>
                    <div class="error-txt-position" style="display: none; color: #8d1717;">
                      <small>役職タグ が選択されていません</small>
                    </div>
                    <div class='flex my-1'>
                      <!-- <label class="flex mr-4"> -->
                      <span class="flex mr-4">
                        <input class="tag-checkbox-position" type="checkbox" />
                        <span class="my-0 ml-2">all</span>
                        {% for optionitem in position %}

                        <input class="tag-checkbox" type='checkbox' name="position" value={{optionitem.id}} />
                        <span class="my-0 ml-2">{{optionitem.name}}</span>
                        {% endfor %}
                      </span>
                    </div>
                  </div>
                </div>
                <div class='flex flex-s my-4 input-required-team'
                  style="display: flex;align-items: center;font-size: 14px;">
                  <div class="tags_heading">
                    <p class='m-2 heading-required'>チームタグ</p>
                  </div>
                  <div>
                    <div class="error-txt-team" style="display: none;color: #8d1717;">
                      <small>チームタグ が選択されていません</small>
                    </div>
                    <div class='flex my-1'>
                      <!-- <label class="flex mr-4"> -->
                      <div class="flex mr-4">
                        <input class="tag-checkbox-team" type="checkbox" />
                        <span class="my-0 ml-2">all</span>
                        {% for optionitem in team %}
                        <input class="tag-checkbox-two" type='checkbox' name="team" value={{optionitem.id}} />
                        <span class="my-0 ml-2">{{optionitem.name}}</span>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
                <div class='flex flex-s my-4 input-required'>
                  <div class="tags_heading">
                    <p class='m-2 heading-required'>学習カテゴリー</p>
                  </div>
                  <div class="tameru-about">
                    <p class="m-0 color-red error-txt"><small></small></p>
                    <div class='flex flex-wrap my-1 learning_categories'>
                    </div>
                    <div class="topic--wrap">
                      <div class='tameru-tabs-list'>
                      </div>
                      <div class='flex flex-s flex-item-center'>
                        <input type='text' class='kb-input kb-input-md form-data' data-prop='topic'
                          placeholder='入力してください' id="topic" />
                        <button class='btn-tran ml-3 input-add-tabs-list topic--btn'>
                          <i class='fas fa-plus mr-2'></i> 追加 </button>
                      </div>
                    </div>
                    <p class="mb-0"><small class="text-muted">追加ボタンを押すことでタグの追加ができます。</small></p>
                  </div>
                </div>
              </div>
            </div>
            <div class='kb-panel my-4 comment-container'>
              <div class='kb-panel-title p-3'>
                <p class='m-0'>この課題につけられたコメント</p>
              </div>
              <div class='kb-panel-body tameru-form comment-panel description-text px-3'>
              </div>
            </div>
          </div>
          <div class="tameru-create-area-wrap">
            <div class=" tameru-create-area">
              <div class='kb-panel'>
                <div class='kb-panel-title p-3'>
                  <p class='m-0'>公開設定</p>
                </div>
                <div class='kb-panel-body text-center px-3'>
                  <select class='full form-data flag-status' data-prop='draftFlag'>
                    <option value="1">下書き</option>
                    <option value="0">公開</option>
                  </select>
                  <button class='submit-btn mt-4 add-tameru-create-btn' style="padding-bottom: 29px;">
                    入力内容を保存する</button>
                  <a href='' class="display-none color-blue">プレビュー</a>
                </div>
              </div><a class="btn-tran mt-4 tameru-delete-btn"><i
                  class="fas fa-trash remove-question-type mr-2"></i>この課題を削除する</a>
              <a href="/question/" class="btn-tran mt-3 tameru-cancel-btn">編集をキャンセルする</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src='/static/ver2.1/js/varidate.js'></script>
  <script src='/static/ver2.1/js/script.js'></script>
  <script>

    function getSelectionHtml() {
      var html = "";
      if (typeof window.getSelection != "undefined") {
        var sel = window.getSelection();
        if (sel.rangeCount) {
          var container = document.createElement("div");
          for (var i = 0, len = sel.rangeCount; i < len; ++i) {
            container.appendChild(sel.getRangeAt(i).cloneContents());
          }
          html = container.innerHTML;
        }
      } else if (typeof document.selection != "undefined") {
        if (document.selection.type == "Text") {
          html = document.selection.createRange().htmlText;
        }
      }
      return html;
    }
    var global_text = "";

    var learning_categories = ["基礎", "計画", "ターゲット", "アポイント", "解決", "交渉", "フォロー", "企画", "市場調査", "マナー", "専門", "戦略", "訪問", "提案", "プレゼンテーション", "ヒアリング", "事務", "クレーム", "予測", "気づかい", "アプローチ", "管理", "販売", "コミュニケーション", "ファイナンス", "知識", "マーケティング", "アナリティクス", "分析", "リサーチ", "html", "css", "javascript", "フレーム", "デバック", "テスト", "サーバー", "マネジメント", "ユーザーインターフェイス", "ユーザーエクスペリエンス", "サイト", "マーク", "ソース", "レイアウト", "設計", "バグ", "装飾", "動き", "アニメーション", "アプリケーション", "デバック", "フレーム", "jquery", "react", "angular", "問題", "原因", "テスト", "php", "ruby", "サーバー", "管理", "交流", "デザイン", "ウェブ", "リンク", "EC", "aws", "apache", "mysql", "Bootstrap", "ajax", "API", "情報", "アプリ", "html", "css", "javascript", "データベース", "フレーム", "サーバー", "マネジメント", "プログラミング", "データ", "python", "コード", "コーディング", "セキュリティ", "攻撃", "漏洩", "対策", "ネットワーク", "データ", "分析", "Eコマース", "EC", "ソフトウェア", " 開発", "設計", "開発", "運用", "保守", "コミュニケーション", "交流", "linux", "seo", "フロント", "バック", "アプリ", "java", "c", "app", "swift", "修正", "監視", "要件定義", "kotlin", "上流", "下流", "リーダー"]

    $(document).ready(function () {
      $(document).on('mouseleave', '.tameru-form', function () {
        $('.filling-editor span').contents().unwrap();
        // $('.wysiwyg').html($('.wysiwyg').html());
      });
      $(document).on('mousedown', '.filling-editor span', function () {
        $('.filling-anser-text').text($(this).text());
        // global_text = $(this).contents().text();
         global_text = $('.filling-anser-text').text();
        $(this).contents().unwrap().wrap("<p class='filling'></p>");
        // $(this).find('.filling').contents().unwrap().wrap("<a class='filling'></a>")
        $('.filling').each(function () {
          if ($(this).text().length == 0) {
            $(this).remove();
          }
          if ($(this).has('.filling')) {
            $(this).find('.filling').contents().unwrap();
          }
          $(this).append("<a class='filling_delete'></a>");
        });
      });
      $(document).on('mouseup', '.filling-editor', function () {
        if ($('.filling-editor .filling').length == 0) {
          $('.filling-editor span').contents().unwrap();
          var range = window.getSelection().getRangeAt(0),
            content = range.extractContents(),
            span = document.createElement('span');
          span.appendChild(content);
          var htmlContent = span.innerHTML;
          if (span.innerHTML.length != 0) {
            range.insertNode(span);
          }

          $('.filling').append("<a class='filling_delete'></a>");
        }
      });

      $(document).on('mousedown', '.filling_delete', function () {
        $('.filling-anser-text').text('');
        $(this).parents('.filling').contents().unwrap();
        $(this).remove();
        $('.filling-editor').html($('.filling-editor').html());
      });

      for (var i = 0; i < learning_categories.length; i++) {
        $('.learning_categories').append(`
          <label class="flex mr-4">
            <input type='checkbox' name="learningcategory" value="${learning_categories[i]}"/>
            <span class="my-0 ml-2">${learning_categories[i]}</span>
          </label>
        `)
      }

      /**
      * 要素を選択してクリップボードへコピー
      * @param {Element} elem コピーする要素
      * @return {boolean} コピーに成功した場合はtrue、失敗した場合はfalseを返す
      */

      // var copyElementToClipboard = function (elem) {
      //   // 要素を選択
      //   selectElement(elem);

      //   // クリップボードへコピー
      //   var result = document.execCommand('copy');

      //   // 選択を解除
      //   document.getSelection().removeAllRanges();

      //   return result;
      // };

      // /**
      // * 要素を選択
      // * @param {Element} elem 選択する要素
      // */
      // var selectElement = function (elem) {
      //   // 選択範囲を操作するRangeオブジェクトを用意する
      //   var range = document.createRange();

      //   // 選択範囲を設定する（引数に選択状態にする要素を指定）
      //   range.selectNode(elem);

      //   // ユーザーの選択状態を得る
      //   var selection = document.getSelection();

      //   // 現在の選択状態を解除する
      //   selection.removeAllRanges();

      //   // 対象要素を選択状態にする
      //   selection.addRange(range);
      // };

      // var sampleElem = document.getElementById('sample');
      // var copyBtnElem = document.getElementById('copy');

      // copyBtnElem.addEventListener('click', function () {
      //   var result = copyElementToClipboard(sampleElem);

      //   if (result) {
      //     alert('コピーに成功');
      //   } else {
      //     alert('コピーに失敗');
      //   }
      // });

      addDefault();

      var yesNo = function (load) {
        $(".question-type-media").empty();
        $(".question-type-media").append(`
                    <div class="question-type-media-thumb-wrap">
                        <div class='flex flex-sb flex-item-center question-type-media-thumb'>
                            <div class='flex flex-sb flex-item-center'>
                                <div>
                                    <input type="text" disabled="disabled" class='kb-input kb-input-md form-data-ans' data-prop='label' value="Yes" style='display:none'><img src="/static/ver2.1/img/circle.svg" alt="○" style='height:2rem'>
                                </div>
                                <div class='px-3'>
                                    <label class="switch">
                                        <input type="checkbox" class="form-data-ans"  data-prop='correctFlag' id="togBtn" />
                                        <div class="slider round"> </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="question-type-media-thumb-wrap">
                        <div class='flex flex-sb flex-item-center question-type-media-thumb'>
                            <div class='flex flex-sb flex-item-center'>
                                <div>
                                    <input type="text" disabled="disabled" class='kb-input kb-input-md form-data-ans' data-prop='label' value="No" style='display:none'><i class='fas fa-times' style='color:#d95243;font-size:2.3rem;margin:0 0.1em;'></i>
                                </div>
                                <div class='px-3'>
                                    <label class="switch">
                                        <input type="checkbox" class="form-data-ans"  data-prop='correctFlag' id="togBtn" />
                                        <div class="slider round"> </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
        if (load !== true) {
          $(".question-type-media>div:first-child").find(".switch input").click();
        }
      }

      $(".question-type-select").on("change", function () {
        var datalead = [
          '正しいものを１つ選びなさい。',
          '誤っているものを１つ選びなさい。',
          '正しいものをすべて選びなさい。',
          '誤ったものをすべて選びなさい。',
          '正しい場合には○を、間違っている場合には✕を選びなさい。',
          '空欄に入る語句や数字を入力しなさい。',
        ];
        $(".wysiwyg-heading").text(datalead[(Number($(".question-type-select").val())) - 1]);

        $(".question-type-media").empty();
        if (parseInt($(".question-type-select").val()) == 5) {
          yesNo();
          $('.problemStatement .filling').contents().unwrap()
          $('.problemStatement').removeClass('filling-editor');
          $('.filling-toggle').hide();
          $('.anser-input').show();
        }
        else if (parseInt($(".question-type-select").val()) == 6) {
          $('.problemStatement').addClass('filling-editor');
          $('.filling-toggle').show();
          $('.filling-anser-kana').css('display', 'flex');
          $('.anser-input').hide();
        }
        else {
          $('.problemStatement .filling').contents().unwrap()
          $('.problemStatement').removeClass('filling-editor');
          $('.filling-toggle').hide();
          $('.anser-input').show();
          addDefault();
        }
      })


      $(".anser-type-select").on("change", function () {

        var datalead = [
          '',
          'タイトル文を入力してください。\nリード文を入力してください。\n\nO 解答１: あああああああ\n解説を入力してください\n\n× 解答2: あああああああ\n解説を入力してください\n\n× 解答3: あああああああ\n解説を入力してください\n\n× 解答4: あああああああ\n解説を入力してください',
        ];

        $(".descriptionText").text(datalead[(Number($(".anser-type-select").val())) - 1]);



      })


      $(".filling-anser-kana-input").on('keyup', function () {
        var kana = input_varidate('.filling-anser-kana-input', {
          type: 'kana',
        });
        if (kana != true) {
          input_errorElement('.filling-anser-kana-input', '入力形式が異なります。', '.filling-anser-kana-input-wrap');
        } else {
          input_errorElement('.filling-anser-kana-input', '', '.filling-anser-kana-input-wrap');
        }
      })

      // $(".tag-checkbox-position").on("change", function () {
      //   if ($(this).val() == "all") {

      //     console.log("all is being called");
      //     $(".tag-checkbox").prop("checked",true);
      //    // $(this).parent().siblings().find('.tag-checkbox').prop('checked', false);
      //     $(this).prop('checked', true);
      //   } else {
      //     console.log("m being called")
      //    // $(this).parent().siblings().find('.tag-all').prop('checked', false);
      //   }
      //   var datalead = [
      //     '',
      //     'タイトル文を入力してください。\nリード文を入力してください。\n\nO 解答１: あああああああ\n解説を入力してください\n\n× 解答2: あああああああ\n解説を入力してください\n\n× 解答3: あああああああ\n解説を入力してください\n\n× 解答4: あああああああ\n解説を入力してください',
      //   ];
      //   $(".descriptionText").text(datalead[(Number($(".anser-type-select").val())) - 1]);
      // })

      $('.tag-checkbox-position').on('click', function () {
        if (this.checked) {
          $('.tag-checkbox').each(function () {
            this.checked = true;
          });
        } else {
          $('.tag-checkbox').each(function () {
            this.checked = false;
          });
        }
      });

      $('.tag-checkbox').on('click', function () {
        if ($('.tag-checkbox:checked').length == $('.tag-checkbox').length) {
          $('.tag-checkbox-position').prop('checked', true);
        } else {
          $('.tag-checkbox-position').prop('checked', false);
        }
      });

      $('.tag-checkbox-team').on('click', function () {
        if (this.checked) {
          $('.tag-checkbox-two').each(function () {
            this.checked = true;
          });
        } else {
          $('.tag-checkbox-two').each(function () {
            this.checked = false;
          });
        }
      });

      $('.tag-checkbox-two').on('click', function () {
        if ($('.tag-checkbox-two:checked').length == $('.tag-checkbox-two').length) {
          $('.tag-checkbox-team').prop('checked', true);
        } else {
          $('.tag-checkbox-team').prop('checked', false);
        }
      });

      function addDefault() {
        for (var i = 0; i <= 3; i++) {
          $(".question-type-media").append(`
                                <div class='question-type-media-thumb-wrap'>
                                    <div class='flex flex-sb flex-item-center question-type-media-thumb'>
                                        <div class='flex flex-s'>
                                            <div class='question-type-thumb-filed'>
                                                <input type='text' class='kb-input kb-input-md form-data-ans' data-prop='label' placeholder='回答を' />
                                            </div>
                                        </div>
                                        <div class='flex flex-sb flex-item-center'>
                                            <div class='px-3'>
                                                <label class="switch">
                                                    <input type="checkbox" class="form-data-ans"  data-prop='correctFlag' id="togBtn" />
                                                    <div class="slider round"> </div>
                                                </label>
                                            </div>
                                            <div class='px-3 text-muted'>
                                                <i class='fas fa-trash remove-question-type'></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `);
        }
        $(".add-question-type-media").hide();
        $(".question-type-media>div:first-child").find(".switch input").click();
      }
      $(".add-tabs-list").on("click", function () {
        if ($(this).prev("select").val() != null) {
          var id = $(this).prev("select")[0].selectedIndex;
          var value = $(this).prev("select").find("option:selected").attr("data-value");
          $(this).parent().find(".tameru-tabs-list").append(`<span class='closeable mb-2' data-value='${value}' data-index=${id}>${$(this).prev("select").val()}<i class='close'>x</i></span>`);
          $(this).prev("select").find("option:selected").prop("disabled", true);
        }
      })
      $(".input-add-tabs-list").on("click", function () {
        if (!$(this).hasClass('disabled')) {
          var value = $(this).prev("input").val();
          if (value.trim() != "") {
            let dataValue = JSON.stringify(value);
            $(this).parent().prev(".tameru-tabs-list").append(`<span class='closeable input-closeable mb-2' data-value='${dataValue}'><label>${$(this).prev("input").val()}</label><i class='close'>x</i></span>`);
            $(this).prev("input").val("")
          }
        }
      })
      $(".tameru-often-tabs-item").on("click", function () {
        var value = $(this).text();
        if (value.trim() != "") {
          let dataValue = JSON.stringify(value);
          $(this).parents('.tameru-about').find(".tameru-tabs-list").append(`<span class='closeable input-closeable mb-2' data-value='${dataValue}'><label>${value}</label><i class='close'>x</i></span>`);
          // $(this).hide();
        }
      })
      $(document).on("click", ".closeable.input-closeable", function () {
        $(this).remove();
      })
      $(document).on("click", ".closeable", function () {
        var index = parseInt($(this).attr("data-index"));
        $(this).closest(".tameru-tabs-list").next("select").find("option").eq(index).attr("disabled", false);
        $(this).remove();
      })
      $(".add-question-type-media").on("click", function () {
        if ($(".question-type-media>div").length < 4) {
          $(".question-type-media").append(`
                                <div class='question-type-media-thumb-wrap'>
                                    <div class='flex flex-sb flex-item-center question-type-media-thumb'>
                                        <div class='flex flex-s'>
                                            <div class='question-type-thumb-filed'>
                                                <input type='text' class='kb-input kb-input-md form-data-ans' data-prop='label' placeholder='回答を書き込んでください' />
                                            </div>
                                        </div>
                                        <div class='flex flex-sb flex-item-center'>
                                            <div class='px-3'>
                                            <label class="switch">
                                                <input type="checkbox" class="form-data-ans" data-prop='correctFlag' id="togBtn" />
                                                <div class="slider round"> </div>
                                            </label>
                                            </div>
                                            <div class='px-3 text-muted'>
                                                <i class='fas fa-trash remove-question-type'></i>
                                            </div>
                                        </div>
                                      </div>
                                    </div>
                                </div>
                    `);
        }
        if ($(".question-type-media>div").length >= 4) {
          $(this).hide();
        }
      }).on("mouseenter", function () {
        if ($(".question-type-media>div").length == 4) {
          $(this).css({
            "cursor": "not-allowed"
          })
        }
        else {
          $(this).css({
            "cursor": "pointer"
          })
        }
      })
      $(document).on("click", ".switch input", function () {
        if (parseInt($(".question-type-select").val()) == 1 || parseInt($(".question-type-select").val()) == 5) {
          $(".switch .form-data-ans").prop("checked", false);
          $(this).prop("checked", true);
        }
        if (parseInt($(".question-type-select").val()) == 2) {
          $(".switch .form-data-ans").prop("checked", true);
          $(this).prop("checked", false);
        }
        else if (parseInt($(".question-type-select").val()) == 2) {
          if ($(".switch .form-data-ans:checked").length == 0) {
            var totallength = $(".question-type-media>div").length;
            var index = $(".question-type-media>div").index($(this).closest(".question-type-media-thumb"))
            if (index == 0) {
              $(this).closest(".question-type-media-thumb").next().find(".switch input").click()
            }
            else if (index == totallength - 1) {
              $(this).closest(".question-type-media-thumb").prev().find(".switch input").click()
            }
            else {
              $(this).closest(".question-type-media-thumb").prev().find(".switch input").click()
            }
          }
        }
      })

      $(document).on("click", ".remove-question-type", function () {
        if ($(this).closest(".question-type-media").find(".question-type-media-thumb-wrap").length > 2) {
          $(this).closest(".question-type-media-thumb-wrap").remove();
        }
        if ($(".switch input:checked").length == 0) {
          $(".question-type-media>div:first-child").find(".switch input").click();
        }
        if ($(".question-type-media>div").length <= 4) {
          $(".add-question-type-media").show();
        }
      })
      // $(".question-upload .fa-image").on("click", function () {
      //   $(".question-upload input[type=file]").click();
      // })
      // $(".question-upload input[type=file]").on("change", function (e) {
      //   // $(".question-upload-preview").empty();
      //   var file = e.target.files[0];
      //   var fr = new FileReader();
      //   fr.onload = function (e) {
      //     $(".question-upload-preview").append(`
      //                   <div class="mr-3">
      //                   <img src=${e.target.result} alt=''/>
      //                   <button><i class="fas fa-times"></i></button>
      //                   </div>
      //               `)
      //   }
      //   fr.readAsDataURL(file)
      // })
      // $(document).on("click", ".question-upload-preview button", function () {
      //   $(this).parent().empty();
      //   // $(".question-upload-preview").empty();
      // })

      // クリックで画像を選択する場合
      $(document).on("click", ".drop_area", function () {
        // if(url == 'edit'){
        //   var image = $('.uploadArea_wrap').attr('data-image')-2;
        //   var imageID = "questionImg-"+image;
        //   $('#' + imageID + ' .input_file').click();
        //   console.log('edit is',imageID);
        // }
        // else if(url == 'create'){
        //   var imageID = $(this).parent().attr('id');
        // console.log('create is',imageID);
        // $('#' + imageID + ' .input_file').click();
        // }
        var imageID = $(this).parent().attr('id');

        $('#' + imageID + ' .input_file').click();


      });

      $(document).on("click", ".drop_area_des", function () {
        var imageid = $(this).parent().attr('id');
        $('#' + imageid + ' .input_file_des').click();
      })

      $(document).on("change", ".input_file", function () {
        var imageID = $(this).parent().attr('id');

        // 画像が複数選択されていた場合
        if (this.files.length > 1) {
          alert('アップロードできる画像は1つだけです');
          $('#' + imageID + ' .input_file').val('');
          return;
        }
        handleFiles(imageID, this.files);
      });
      $(document).on("change", ".input_file_des", function () {
        var imageid = $(this).parent().attr('id');
        // 画像が複数選択されていた場合
        if (this.files.length > 1) {
          alert('アップロードできる画像は1つだけです');
          $('#' + imageid + ' .input_file_des').val('');
          return;
        }
        handleFilesDes(imageid, this.files);
      });
      $(document).on('dragenter dragover', '.drop_area', function (event) {
        var imageID = $(this).parent().attr('id');
        event.stopPropagation();
        event.preventDefault();
        $('#' + imageID + ' .drop_area').css('border', '1px solid #aaa');  // 枠を実線にする
      });
      $(document).on('dragleave', '.drop_area', function (event) {
        var imageID = $(this).parent().attr('id');
        event.stopPropagation();
        event.preventDefault();
        $('#' + imageID + ' .drop_area').css('border', '1px dashed #aaa');  // 枠を点線に戻す
      });
      $(document).on('drop', '.drop_area', function (event) {
        var imageID = $(this).parent().attr('id');
        event.preventDefault();

        $('#' + imageID + ' .input_file')[0].files = event.originalEvent.dataTransfer.files;

        // 画像が複数選択されていた場合
        if ($('#' + imageID + ' .input_file')[0].files.length > 1) {
          alert('アップロードできる画像は1つだけです');
          $('#' + imageID + ' .input_file').val('');
          return;
        }
        handleFiles(imageID, $('#' + imageID + ' .input_file')[0].files);
      });

      $(document).on('dragenter dragover', '.drop_area_des', function (event) {
        var imageid = $(this).parent().attr('id');
        event.stopPropagation();
        event.preventDefault();
        $('#' + imageid + ' .drop_area_des').css('border', '1px solid #aaa');  // 枠を実線にする
      });
      $(document).on('dragleave', '.drop_area_des', function (event) {
        var imageid = $(this).parent().attr('id');
        event.stopPropagation();
        event.preventDefault();
        $('#' + imageid + ' .drop_area_des').css('border', '1px dashed #aaa');  // 枠を点線に戻す
      });
      $(document).on('drop', '.drop_area_des', function (event) {
        var imageid = $(this).parent().attr('id');
        event.preventDefault();

        $('#' + imageid + ' .input_file_des')[0].files = event.originalEvent.dataTransfer.files;

        // 画像が複数選択されていた場合
        if ($('#' + imageid + ' .input_file_des')[0].files.length > 1) {
          alert('アップロードできる画像は1つだけです');
          $('#' + imageid + ' .input_file_des').val('');
          return;
        }
        handleFilesDes(imageid, $('#' + imageid + ' .input_file_des')[0].files);
      });
      // 選択された画像ファイルの操作
      function handleFiles(imageID, files) {
        var file = files[0];
        var imageType = 'image.*';

        // ファイルが画像が確認する
        if (!file.type.match(imageType)) {
          alert('画像を選択してください');
          $('#' + imageID + ' .input_file').val('');
          $('#' + imageID + ' .drop_area').css('border', '1px dashed #aaa');
          return;
        }

        $('#' + imageID + ' .drop_area').hide();  // いちばん上のdrop_areaを非表示にします
        $('#' + imageID + ' .img_clear_button').show();  // icon_clear_buttonを表示させます

        var img = document.createElement('img');  // <img>をつくります
        var reader = new FileReader();
        reader.onload = function () {  // 読み込みが完了したら
          img.src = reader.result;  // readAsDataURLの読み込み結果がresult
          $('#' + imageID + ' .preview_field').append(img);
          $('.uploadArea_wrap').removeClass('edit-css');
        }
        reader.readAsDataURL(file); // ファイル読み込みを非同期でバックグラウンドで開始
        var parentID = $('#' + imageID).parent().attr('id');

        $('#' + parentID).attr('data-image', Number($('#' + parentID).attr('data-image')) + 1);

        var images = $('#' + parentID + ' .uploadArea').length;
        if (images < 5) {
          $('#' + parentID).append(
            '<div class="uploadArea" id="' + parentID + '-' + (Number($('#' + parentID).attr('data-image')) + 2) + '">\
            <input type="file" name="image" class="input_file" accept="image/*">\
              <div class="preview_field"></div>\
              <div class="drop_area"><i class="far fa-image mr-2"></i>画像を追加</div>\
              <div class="img_clear_button"></div>\
          </div>'
          );
        }

      }

      function handleFilesDes(imageID, files) {
        var file = files[0];
        var imageType = 'image.*';

        // ファイルが画像が確認する
        if (!file.type.match(imageType)) {
          alert('画像を選択してください');
          $('#' + imageID + ' .input_file_des').val('');
          $('#' + imageID + ' .drop_area_des').css('border', '1px dashed #aaa');
          return;
        }

        $('#' + imageID + ' .drop_area_des').hide();  // いちばん上のdrop_areaを非表示にします
        $('#' + imageID + ' .img_clear_button_des').show();  // icon_clear_buttonを表示させます

        var img = document.createElement('img');  // <img>をつくります
        var reader = new FileReader();
        reader.onload = function () {  // 読み込みが完了したら
          img.src = reader.result;  // readAsDataURLの読み込み結果がresult

          // preview_filedに画像を表示
          $("#" + imageID + ' .preview_field_des').append(img);
          $('.uploadArea_wrap_des').removeClass('edit-css');
        }
        reader.readAsDataURL(file); // ファイル読み込みを非同期でバックグラウンドで開始
        var parentID = $('#' + imageID).parent().attr('id');
        $('#' + parentID).attr('data-image', Number($('#' + parentID).attr('data-image')) + 1);
        var images = $('#' + parentID + ' .uploadArea_des').length;
        if (images < 5) {
          $('#' + parentID).append(
            '<div class="uploadArea_des" id="' + parentID + '-' + $('#' + parentID).attr('data-image') + '">\
            <input type="file" name="image_des" class="input_file_des" accept="image/*">\
              <div class="preview_field_des"></div>\
              <div class="drop_area_des"><i class="far fa-image mr-2"></i>画像を追加</div>\
              <div class="img_clear_button_des"></div>\
          </div>'
          );
        }

      }
      $(document).on('click', '.img_clear_button', function (event) {
        imageID = $(this).parent().attr('id');
        var parentID = $('#' + imageID).parent().attr('id');
        var images = $('#' + parentID + ' .uploadArea').length;
        $('#' + imageID).remove();
        if (images == 2) {
          $('.uploadArea_wrap').removeClass('edit-css');
        }
        if (images == 5 && $('#' + parentID + ' .uploadArea:last input').val() != "") {
          $('#' + parentID).append(
            '<div class="uploadArea" id="' + parentID + '-' + (images + 1) + '">\
            <input type="file" name="image" class="input_file" accept="image/*">\
              <div class="preview_field"></div>\
              <div class="drop_area"><i class="far fa-image mr-2"></i>画像を追加</div>\
              <div class="img_clear_button"></div>\
          </div>'
          );
        }

      })
      $(document).on('click', '.img_clear_button_des', function (event) {
        imageID = $(this).parent().attr('id');
        var parentID = $('#' + imageID).parent().attr('id');
        var images = $('#' + parentID + ' .uploadArea_des').length;
        $('#' + imageID).remove();
        if (images == 2) {
          $('.uploadArea_wrap_des').removeClass('edit-css');
        }
        if (images == 5 && $('#' + parentID + ' .uploadArea_des:last input').val() != "") {
          $('#' + parentID).append(
            '<div class="uploadArea_des" id="' + parentID + '-' + (images + 1) + '">\
            <input type="file" name="image_des" class="input_file_des" accept="image/*">\
              <div class="preview_field_des"></div>\
              <div class="drop_area_des"><i class="far fa-image mr-2"></i>画像を追加</div>\
              <div class="img_clear_button_des"></div>\
          </div>'
          );
        }
      })
      // drop_area以外でファイルがドロップされた場合、ファイルが開いてしまうのを防ぐ
      $(document).on('dragenter', function (event) {
        event.stopPropagation();
        event.preventDefault();
      });
      $(document).on('dragover', function (event) {
        event.stopPropagation();
        event.preventDefault();
      });
      $(document).on('drop', function (event) {
        event.stopPropagation();
        event.preventDefault();
      });


      let url = getUrl();
      let global_data = '';
      if (url == "edit") {
        let qid = JSON.parse(localStorage.getItem("tameru_edit"));
        $.ajax({
          method: "POST",
          url: '/question/tameruByQuestionId',
          headers: { "Content-Type": "application/json" },
          data: JSON.stringify({
            "questionId": qid
          }),
          success: function (result) {
            global_data = result.data[0];
            let data = global_data;
            getComment();
            if (data.draftFlag == '公開済み') {
              $(".flag-status option").eq(1).prop("selected", true);
            }
            else {
              $(".flag-status option").eq(0).prop("selected", true);
            }

            $(".kb-textarea-md").text(data.problemStatement);

            if (data.questionPicture.length > 0) {
              data.questionPicture.map((picture, i) => {
                var imageId = "questionImg-";
                var index = 1

                $('.uploadArea_wrap').append(
                  `
                   <div class='uploadArea' id=${imageId}${i + 2}>

                    <div class="preview_field" id=${imageId}${i + 2}>
                      <img src=${picture} alt='' />
                      <div class="img_clear_button question_edit"></div>
                    </div>
                   </div>
                  `
                )
                $('.question_edit').show();
                $('.uploadArea_wrap').addClass('edit-css');
                var i = parseInt($('.uploadArea_wrap').attr('data-image'));
                $('.uploadArea_wrap').attr('data-image', i + 1);


              })
            }

            if (data.descriptionPicture.length > 0) {
              data.descriptionPicture.map((picture, i) => {
                var imageId = "anserImg-";
                $('.uploadArea_wrap_des').append(
                  `
                   <div class='uploadArea_des' id=${imageId}${i + 2}>

                    <div class="preview_field_des" id=${imageId}${i + 2}>
                      <img src=${picture} alt='' />
                      <div class="img_clear_button_des description_edit"></div>
                    </div>
                   </div>
                  `
                )
                $('.description_edit').show();
                $('.uploadArea_wrap_des').addClass('edit-css');
              })
            }

            if (data.taglist.length > 0) {
              data.taglist.map(item => {
                $("input[data-prop=topic]").parent().prev().append(`
                            <span class='closeable input-closeable mb-2' data-value='${item}'><label>${item}</label><i class='close'>x</i></span>
                          `);
              })
            }

            if (data.team.length > 0) {
              data.team.map(item => {
                $('input[name="team"]').each(function () {
                  $("input[name=team][value='" + item.id + "']").prop('checked', true);
                })
              })
              if ($('.tag-checkbox-two:checked').length == $('.tag-checkbox-two').length) {
                $('.tag-checkbox-team').prop('checked', true);
              } else {
                $('.tag-checkbox-team').prop('checked', false);
              }
            }

            var datalead = [
              '正しいものを１つ選びなさい。',
              '誤っているものを１つ選びなさい。',
              '正しいものをすべて選びなさい。',
              '誤ったものをすべて選びなさい。',
              '正しい場合には○を、間違っている場合には✕を選びなさい。',
              '空欄に入る語句や数字を入力しなさい。',
            ];
            $(".wysiwyg-heading").text(datalead[data.questionType - 1]);

            if (data.commentaryTemplateFlag == 1) {
              $(".anser-type-select option").eq(0).prop("selected", true);
              $(".descriptionText").text(data.descriptionText);
            }
            else {
              $(".anser-type-select option").eq(1).prop("selected", true);
              $(".descriptionText").text('タイトル文を入力してください。\nリード文を入力してください。\n\nO 解答１: あああああああ\n解説を入力してください\n\n× 解答2: あああああああ\n解説を入力してください\n\n× 解答3: あああああああ\n解説を入力してください\n\n× 解答4: あああああああ\n解説を入力してください');

            }

            if (data.position.length > 0) {
              data.position.map(item => {
                $('input[name="position"]').each(function () {
                  $("input[name=position][value='" + item.id + "']").prop('checked', true);
                })
              })
              if ($('.tag-checkbox:checked').length == $('.tag-checkbox').length) {
                $('.tag-checkbox-position').prop('checked', true);
              } else {
                $('.tag-checkbox-position').prop('checked', false);
              }
            }
            if (data.topicChekbox_list.length > 0) {
              data.topicChekbox_list.map((topic) => {
                $('input[name="learningcategory"]').each(function () {
                  $("input[name=learningcategory][value='" + topic + "']").prop('checked', true);
                })
              })
            }
            $(`select[data-prop=questionType] option[value=${data.questionType}]`).prop("selected", true);
            //   if(data.questionType==3){
            //     $(".add-question-type-media").hide();
            //   }

            $(".question-type-media").empty();
            data.answers.map((item, index) => {
              if (data.questionType == 5) {
                if (index == 0) {
                  yesNo(true);
                }
              }

              else if (data.questionType == 6) {
                if (data.answers.length > 0) {
                  data.answers.map((item) => {
                    var t = $('.problemStatement').html();
                    if(item.answer.length == 0){
                      t = t.replace(item.answer,`<p style="margin-top:0px;">${item.answer}`);
                    }
                    else{
                      t = t.replace(item.answer, `<p class='filling'>${item.answer}</p>`);
                    }


                    $('.problemStatement').html(t);
                    $('.filling').append("<a class='filling_delete'></a>");
                    $('.problemStatement').addClass('filling-editor');
                     global_text = item.answer;
                    $('.filling-anser-text').text(item.answer);
                    $('.filling-editor').addClass('.filling')
                    $('#kana-input').val(item.strType);
                    $('.filling-toggle').show();
                    $('.filling-anser-kana').css('display', 'flex');
                    $('.anser-input').hide();
                  })
                }

              }

              else {
                $(".question-type-media").append(`
                                <div class="question-type-media-thumb-wrap">
                                    <div class='flex flex-sb flex-item-center question-type-media-thumb'>
                                        <div class='flex flex-s'>
                                            <div class='question-type-thumb-filed'>
                                                <input type="text" class='kb-input kb-input-md form-data-ans' data-prop='label' placeholder='回答を書き込んでください'>
                                            </div>
                                        </div>
                                        <div class='flex flex-sb flex-item-center'>
                                            <div class='px-3'>


                                            <label class="switch">
                                                <input type="checkbox" class="form-data-ans" data-prop='correctFlag' id="togBtn" />
                                                <div class="slider round"> </div>
                                            </label>
                                            </div>
                                            <div class='px-3 text-muted'>
                                                <i class='fas fa-trash remove-question-type'></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `);
              }
              $('input.form-data-ans').each(function () {
                var lineHeight = parseInt($(this).css('lineHeight'));
                var lines = ($(this).val() + '\n').match(/\n/g).length;
                $(this).height(lineHeight * lines);
              })
              $(".question-type-media>div").eq(index).find("input[data-prop=label]").val(item.label);
              if (item.correctFlag.toLowercase == "true" || item.correctFlag == true || item.correctFlag == "True")
                $(".question-type-media>div").eq(index).find(".switch .form-data-ans").prop("checked", true);

              if ($(".question-type-media>div").length < 4) {
                $(".add-question-type-media").show();
              } else {
                $(".add-question-type-media").hide();
              }
              if (data.questionType == 5) {
                $(".add-question-type-media").hide();
              }
            })
          }
        })
      }
      else {
        $(".comment-container").remove();
        $('.tameru-delete-btn').hide();
      }
      $(document).ready(function () {
        $('#filling-error').hide();
      })

      $(document).on("click", ".tameru_delete--confirm", function () {
        // let data = global_data.questionId;
        obj = {
          'id': global_data.questionId,
          'userId': 1
        }
        $.ajax({
          type: 'POST',
          url: '/question/delete',
          headers: { "Content-Type": "application/json" },
          // data: JSON.stringify(data),
          data: JSON.stringify(obj),
          success: function (result) {
            $("#attention").hide();
            if (result["result"] == "ok") {
              status_show('ok');
              setTimeout(() => {
                window.location.href = "/question";
              }, 2000)
            }
            if (result["result"] == "ng") {
              status_show('failed');
              window.location.href = "/question";
            }
          }
        });
      })

      function getComment() {
        $.ajax({
          type: 'GET',
          url: `/question/getCommentData?questionId=${global_data.questionId}`,
          success: function (result) {
            let data = result.data;
            if (data.length === 0) {
              $(".comment-panel").append(`
                                <div class='flex flex-c my-4'>
                                    <p>表示するコメントがありません.</p>
                                </div>
                                `);
            }
            data.map(item => {
              if (item.deleteFlag === 0) {
                $(".comment-panel").append(`
                                <div class='flex flex-s my-4'>
                                    <div>
                                        <p class='my-2'><small class="text-muted">${item.date}</small></p>
                                        <p class='my-2'>${item.userName}</p>
                                    </div>
                                    <div>
                                        <p class='my-2'>${item.commentText}</p>
                                    </div>
                                </div>
                                `);
              }
              else {
                $(".comment-panel").append(`
                                <div class='flex flex-s my-4'>
                                    <div>
                                        <p class='my-2'><small class="text-muted">${item.date}</small></p>
                                        <p class='my-2'>${item.userName}</p>
                                    </div>
                                    <div>
                                        <p class='my-2 text-muted'>${item.commentText}</p>
                                    </div>
                                </div>
                                `)
              }
            })
          }
        });
      }
      $(document).on("click", ".tameru_delete--cancel", function () {
        $("#attention").hide();
      })

      function getUrl() {
        let hash = window.location.href.split("/");
        let url = hash[hash.length - 1];
        return url;
      }

      function error() {
        $(".kb-tameru-container").append("<div class='status-container error'><p class='px-2'>入力内容に不備があります</p></div>");
        $(".status-container").css({
          position: "fixed",
          top: "80px",
          width: $(".kb-container").outerWidth(),
          marginLeft: $(".kb-container").css("margin-left"),
          zIndex: 2,
          left: '0'
        })
        $(".status-container.error").css({
          background: "#d95243",
          color: "#fff"
        })
      }

      // $('#topic').on("keyup keypress keydown", function () {
      //   var topicVari = input_varidate('#topic', {
      //     maxLength: 100,
      //     message: 'カテゴリタグ'
      //   });
      //
      //   if (topicVari !== true) {
      //     $('.topic--btn').addClass('disabled');
      //     input_errorElement('#topic', topicVari, '.topic--wrap');
      //   } else {
      //     $('.topic--btn').removeClass('disabled');
      //     input_errorElement('#topic', '', '.topic--wrap');
      //   }
      // });


      $('#topic').on("keyup keypress keydown", function () {
        if (learning_categories.indexOf($('#topic').val()) != -1) {
          $('.topic--btn').addClass('disabled');
          input_errorElement('#topic', 'このカテゴリーは既に追加されています。', '.topic--wrap');
        } else {
          $('.topic--btn').removeClass('disabled');
          input_errorElement('#topic', '', '.topic--wrap');
        }
      });


      $(".tameru-delete-btn").on("click", function () {
        $("#attention").show();
      });

      // $(document).ready(function () {
      //   $("body").prepend('<div id="overlay" class="ui-widget-overlay" style="z-index: 1001; display: none;"></div>');
      //   $("body").prepend("<div id='PleaseWait' style='display: none;'><img src='/images/spinner.gif'/></div>");
      // });

      $(".add-tameru-create-btn").on("click", function () {

        $(this).prop("disabled", true);
        $('.kb-container-loading').show();
        let css = 'fa-spin';
        $('.fa-spinner').show().addClass(css);
        $('.tameru-create-header').css({
          'opacity': '0.5'
        });
        $('.loading').css({
          'opacity': '0.5'
        })

        document.getElementById("hidden_text_data").value = $(".cmt_msg").val().replace(/\n/g, "<br>");
        $(".status-container").remove();
        var draftFlag = '下書き';
        if ($('[data-prop="draftFlag"]').val() == 0) {
          draftFlag = '公開';
        };

        var error_obj = {
          questionText: false,
          questionType: true,
          companypositionId: false,
          companyteamId: false,
          descriptionText: false,
          topicCheckbox: false,
          ans_len: true,
          question_six_ans: true,

          question_six_input: true
        }
        var obj = {
          questionText: '',
          commentaryTemplateFlag: '',
          questionType: '',
          topicCheckbox: [],
          answers: [],
          companypositionId: [],
          descriptionText: '',
          companyteamId: [],
          topic: [],
          questionPicture: [],
          descriptionPicture: []
          //questionPicture: $(".question-upload-preview img").attr("src") == undefined ? 0 : $(".question-upload-preview img").attr("src")
        }
        // var descriptionText=$(".description-text textarea").val();
        // if(descriptionText.trim()==""){
        //     $(".description-text textarea").css({
        //         border: '1px solid red'
        //     })
        //     $(".description-text textarea").addClass("error-field").attr("placeholder",'入力されていません');
        //     error();
        //     error_obj.descriptionText = false;
        //     $('.description-text textarea').closest('.input-required').children("div").eq(0).find("p").addClass("required");
        // }
        // else{
        //     $(".description-text textarea").removeClass("error-field").attr("placeholder",'解説を入力してください');
        //     $(".description-text textarea").css({
        //         border: '1px solid #c9cad0'

        //     });
        //     error_obj.descriptionText = true;
        //     obj.descriptionText=descriptionText;
        // }
        // var questionText = $(".question-upload textarea").val();
        // if (questionText.trim() == "") {
        //     $(".question-upload textarea").css({
        //         border: '1px solid red'
        //     })
        //     $(".question-upload textarea").addClass("error-field").attr("placeholder",'入力されていません');
        //     error_obj.questionText = false;
        //     $(".question-upload textarea").closest('.input-required').children("div").eq(0).find("p").addClass("required");
        //     error();

        // }
        // else {
        //     $(".question-upload textarea").removeClass("error-field").attr("placeholder",'課題内容を入力してください');
        //     $(".question-upload textarea").css({
        //         border: '1px solid #c9cad0'
        //     });
        //     error_obj.questionText = true;
        //     obj.questionText=questionText;
        // }
        obj.commentaryTemplateFlag = $('.anser-type-select').val();

        if (draftFlag == '公開' && $('.question-upload .problemStatement').text() == 0) {
          var questionTextVari = input_varidate('#content_text', {
            required: true,
            maxLength: 1000,
            message: '課題内容'
          });

        } else {
          var questionTextVari = input_varidate('#content_text', {
            maxLength: 1000,
            message: '課題内容'
          });

        }

        if (questionTextVari !== true) {
          input_errorElement('.problemStatement', questionTextVari, '.questionText-wrap');
          error_obj.questionText = false;
        } else {
          input_errorElement('.problemStatement', '', '.questionText-wrap');
          error_obj.questionText = true;
          var questionText = $(".question-upload .problemStatement").text();
          obj.questionText = questionText;
        }

        var questionType = $(".question-type-select").val();
        if (parseInt(questionType) == 1) {
          if ($(".question-type-media>div").length > 1) {
            if ($(".switch input:checked").length > 0) {
              error_obj.questionType = true;
              $(".question-type-select").css({
                border: '1px solid #c9cad0'
              });
            }
            else {
              if (draftFlag == '公開') {
                error_obj.questionType = false;
                $(".question-type-select").css({
                  border: '1px solid red'
                });
                $(".question-type-select").closest('.input-required').children("div").eq(0).find("p").addClass("required");
              }
            }
          }
          else {
            if (draftFlag == '公開') {
              error_obj.questionType = false;
              $(".question-type-select").css({
                border: '1px solid red'
              });
              $(".question-type-select").closest('.input-required').children("div").eq(0).find("p").addClass("required");
            }

          }
        }
        else if (parseInt(questionType) == 2) {
          if ($(".question-type-media>div").length > 1) {
            if ($(".switch input:checked").length > 0) {
              error_obj.questionType = true;
              $(".question-type-select").css({
                border: '1px solid #c9cad0'
              });
            }
            else {
              if (draftFlag == '公開') {
                error_obj.questionType = false;
                $(".question-type-select").css({
                  border: '1px solid red'
                });
              }
            }
            $(".question-type-select").closest('.input-required').children("div").eq(0).find("p").addClass("required");

          }
          else {
            if (draftFlag == '公開') {
              error_obj.questionType = false;
              $(".question-type-select").css({
                border: '1px solid red'
              });
              $(".question-type-select").closest('.input-required').children("div").eq(0).find("p").addClass("required");
            }

          }
        }
        else if (parseInt(questionType) == 6) {
          var input_text = $(".filling-anser-kana-input-wrap").children().val();
          if (global_text.length == 0 && input_text.length == 0 && draftFlag == '公開') {
            // $(".question-type-select").css({
            //   border: '1px solid red'
            // });
            //$('.question-type-select').closest('.input-required').children("div").eq(0).find("p").addClass("required");
          }
          else {
            $(".question-type-select").css({
              border: '1px solid #c9cad0'
            });
            // $('.question-type-select').closest('.input-required').children("div").eq(0).find("p").removeClass("required");
          }
        }
        else {
          if ($(".switch input:checked").length > 0) {
            error_obj.questionType = true;
            $(".question-type-select").css({
              border: '1px solid #c9cad0'
            });
          }
          else {
            if (draftFlag == '公開') {
              error_obj.questionType = false;
              $(".question-type-select").css({
                border: '1px solid red'
              });
              $(".question-type-select").closest('.input-required').children("div").eq(0).find("p").addClass("required");
            }

          }

        }

        let ans_field = $(".question-type-media").find("input[type=text]");
        for (var i = 0; i < ans_field.length; i++) {
          ans_field.eq(i).parents('.question-type-media-thumb').next().remove();
          if (ans_field.eq(i).val() == "" && draftFlag == '公開') {
            ans_field.eq(i).css({
              border: '1px solid red'
            })
            input_errorMessage(ans_field.eq(i), '回答が入力されていません');
            $(".question-type-media").closest('.input-required').children("div").eq(0).find("p").addClass("required");
            // error();

            if (draftFlag == '公開') {
              error_obj.ans_len = false;
            }
          }
          else {
            if (ans_field.eq(i).val().length >= 100 && draftFlag == '公開') {
              ans_field.eq(i).css({
                border: '1px solid red'
              })
              ans_field.eq(i).addClass('question-type-media-num' + i).parents('.question-type-media-thumb-wrap').addClass('question-type-media-thumb-num' + i);
              input_errorElement('.question-type-media-num' + i, '上限の100文字を超えています', '.question-type-media-thumb-num' + i);
              $(".question-type-media").closest('.input-required').children("div").eq(0).find("p").addClass("required");
              // error();
              error_obj.ans_len = false;
            }
            else {
              ans_field.eq(i).css({
                border: '1px solid #c9cad0'
              })
              ans_field.eq(i).removeClass("error-field");
            }
          }
        }

        if (draftFlag == '公開') {
          var descriptionTextVari = input_varidate('.description-text textarea', {
            required: true,
            maxLength: 2000,
            message: '解説'
          });
        } else {
          var descriptionTextVari = input_varidate('.description-text textarea', {
            maxLength: 2000,
            message: '解説'
          });
        }
        if (descriptionTextVari !== true) {
          input_errorElement('.descriptionText', descriptionTextVari, '.descriptionText-wrap');
          error_obj.descriptionText = false;
        } else {
          input_errorElement('.descriptionText', '', '.descriptionText-wrap');
          error_obj.descriptionText = true;

          var descriptionText = $(".descriptionText").val();
          obj.descriptionText = descriptionText;
        }

        if (error_obj.questionType == true) {
          obj.questionType = questionType;

          $(".question-type-media>div").each(function () {

            obj.answers.push({
              label: $(this).find("input[type=text]").val(),
              correctFlag: $(this).find(".switch input").prop("checked")
            })

            if (!$(this).find("input[type=text]").val()) {
              // error_obj.ans_len = false;
            }

          })
          if (obj.questionType == 6) {
            if (draftFlag == '公開' && $('.filling-anser-kana-input').val().length == 0) {
              $('.filling-anser-kana-input').css({
                border: '1px solid #d95243'

              });
              $('.filling-anser-kana-input').attr('placeholder', '回答が入力されていません');
              $('.filling-anser-kana-input').addClass('placeholder-css');
              error_obj.question_six_input = false;


            }
            else if ($('.filling-anser-kana-input').val().length > 0) {
              $('.filling-anser-kana-input').css({
                border: '1px solid #c9cad0'

              });
              error_obj.question_six_input = true;

            }
            if ((draftFlag == '公開' && $('.filling-anser-text').text().length == 0)) {
              $('.filling-anser-text').html('<span class=filling>回答が入力されていません</span>')
              error_obj.question_six_ans = false;
            }
            else if ((draftFlag == '公開' && global_text.length == 0)) {
              $('.filling-anser-text').html('<span class=filling>回答が入力されていません</span>')
              error_obj.question_six_ans = false;
            }


            else if (draftFlag == '公開' && $("#blank_text").text().length == 0) {
              $('.filling-anser-text').html('<span class=filling>回答が入力されていません</span>')
              error_obj.question_six_ans = false;
            }

            if ((draftFlag == '公開' && $("#blank_text").text().length > 0) ) {
              if($("#blank_text").text().trim() == 'No answer entered'){
                $('#blank_text').html('<span class=filling>回答が入力されていません</span>')
              error_obj.question_six_ans = false;

              }
              let kana_input = $(".filling-anser-kana-input-wrap").children().val();
              $('.filling-anser-text').addClass('text-muted');

              $('.filling-anser-text').removeClass('color-err-red');


              obj.answers.push({
                "answer":$(".filling-anser-text").text(),
                "strType": kana_input
              })

            }
            else if(draftFlag !== '公開'){
              if($(".filling-anser-text").text().trim() == 'No answer entered'){
                $(".filling-anser-text").text('');
                $('.filling-anser-kana-input').css({
                border: '1px solid #c9cad0'

              });
              $('.filling-anser-kana-input').attr('placeholder', '回答を書き込んでください');
              $('.filling-anser-kana-input').removeClass('placeholder-css');
              }

              let kana_input = $(".filling-anser-kana-input-wrap").children().val();
              $('.filling-anser-text').addClass('text-muted');

              $('.filling-anser-text').removeClass('color-err-red');


              obj.answers.push({
                "answer": $('.filling-anser-text').text().trim() == '回答が入力されていません' || $('.filling-anser-text').text().trim() == 'No answer entered' ? "" : $('.filling-anser-text').text(),
                "strType": kana_input
              })

            }
            //    if ((draftFlag == 'ドラフト' || $("#blank_text").text().length > 0)) {
            //     console.log("One",$("#blank_text").text());
            //     let kana_input = $(".filling-anser-kana-input-wrap").children().val();
            //     obj.answers.push({
            //       "answer": $('#blank_text').text().trim() == 'No answer entered' ? " " : $('#blank_text').text(),
            //       "strType": kana_input
            //     })
            //   }
            //   else if ((draftFlag == 'ドラフト' || global_text.length > 0)) {
            //     console.log("two",global_text);
            //     let kana_input = $(".filling-anser-kana-input-wrap").children().val();
            //     obj.answers.push({
            //       "answer": global_text,
            //       "strType": kana_input
            //     })
            //  }
            //   else if ((draftFlag == 'ドラフト' || $('.filling-anser-text').text().length > 0)) {
            //     console.log("three",$(".filling-anser-text").text())
            //     let kana_input = $(".filling-anser-kana-input-wrap").children().val();
            //     obj.answers.push({
            //       "answer": $('.filling-anser-text').text(),
            //       "strType": kana_input
            //     })
            //   }
          }
        }
        var companypositionId = $(".assignment-settings>div");
        var positionId = [];
        var teamId = [];
        var img_arr = [];
        var description_arr = [];
        var positionArray = "";
        var teamArray = "";
        var learning_cat = [];


        $('input[name="position"]:checked').each(function () {
          positionId.push(this.value);
          positionArray = positionId.toString();
        });

        $('input[name="team"]:checked').each(function () {
          teamId.push(this.value);
          teamArray = teamId.toString();
        });

        $('input[name="learningcategory"]:checked').each(function () {
          learning_cat.push(this.value);

        })

        img_arr = $(".preview_field img").map(function () {
          return $(this).attr("src");

        }).get();

        description_arr = $(".preview_field_des img").map(function () {
          return $(this).attr("src");
        }).get();

        companypositionId.each(function () {
          $(this).find(".error-txt>small").text('');
          if (positionArray.length == 0 && draftFlag == '公開') {
            error_obj.companypositionId = false;
            $(".error-txt-position").show();
            $(this).closest('.input-required-position').children("div").eq(0).find("p").addClass("required");

          }
          else {
            error_obj.companypositionId = true;
            $('.error-txt-position').hide();
            $(this).closest('.input-required-position').children("div").eq(0).find("p").removeClass("required");
          }
          if (teamArray.length == 0 && draftFlag == '公開') {
            error_obj.companyteamId = false;
            $('.error-txt-team').show();
            $(this).closest('.input-required-team').children("div").eq(0).find("p").addClass("required");

          }
          else {
            error_obj.companyteamId = true;
            $('.error-txt-team').hide();
            $(this).closest('.input-required-team').children("div").eq(0).find("p").removeClass("required");
          }
          var obj_name = $(this).find(".form-data").attr("data-prop");
          $(this).find(".tameru-tabs-list>span").each(function () {
            let defaultValue = ''
            if ($(this).hasClass("input-closeable")) {
              defaultValue = $(this).find("label").text();
            }
            else {
              defaultValue = $(this).attr("data-value");
            }
            obj[obj_name].push(defaultValue);
          })
          if ((draftFlag == '公開' && learning_cat.length == 0) && (draftFlag == '公開' && $(this).find(".tameru-tabs-list>span").length == 0)) {
            $(this).find(".error-txt>small").text(`${$(this).find("div:first-child>p").text().split('の追加')[0]} が選択されていません`);
            error_obj.topicCheckbox = false;
          }

          else {
            $(this).find(".error-txt>small").text('');
            error_obj.topicCheckbox = true;
          }




          //if ($(this).find(".tameru-tabs-list>span").length == 0) {
          //console.log('m being called')

          // $(this).find(".form-data").css({
          //   border: '1px solid red'
          // })
          //error_obj[$(this).find(".form-data").attr("data-prop")] = false;
          // $(this).find(".error-txt>small").text(`${$(this).find("div:first-child>p").text().split('の追加')[0]} が選択されていません`);
          // $(this).closest('.input-required').children("div").eq(0).find("p").addClass("required");
          // }
          //

          //  else {
          //   $(this).find(".form-data").css({
          //     border: '1px solid #c9cad0'
          //   });
          //   $(this).closest('.input-required').children("div").eq(0).find("p").removeClass("required");
          //   var obj_name = $(this).find(".form-data").attr("data-prop");
          //   $(this).find(".tameru-tabs-list>span").each(function () {
          //     let defaultValue = ''
          //     if ($(this).hasClass("input-closeable")) {
          //       defaultValue = $(this).find("label").text();
          //     }
          //     else {
          //       defaultValue = $(this).attr("data-value");
          //     }
          //     obj[obj_name].push(defaultValue);
          //   })
          //   error_obj[$(this).find(".form-data").attr("data-prop")] = true;
          //   $(this).find(".error-txt>small").text("");
          // }
        })
        if (draftFlag == '下書き') {
          error_obj.questionType = true;
          error_obj.companypositionId = true;
          error_obj.companyteamId = true;
          error_obj.topic = true;
          error_obj.ans_len = true;

        }

        if (error_obj.questionText == true && error_obj.questionType == true && error_obj.companypositionId == true && error_obj.question_six_ans == true && error_obj.question_six_input == true &&
          error_obj.companyteamId == true && error_obj.descriptionText == true && error_obj.topicCheckbox == true && error_obj.ans_len == true) {


          obj.questionPicture = img_arr;
          obj.companypositionId = positionArray;
          obj.companyteamId = teamArray;
          obj.topicCheckbox = JSON.stringify(learning_cat);

          obj.descriptionPicture = description_arr;
          obj.topic = JSON.stringify(obj.topic);
          obj.draftFlag = $(".flag-status").val();
          let hash = window.location.href.split("/");
          let url = hash[hash.length - 1];
          let api_url;
          if (url == "edit") {
            api_url = '/question/edit';
            obj.questionId = global_data.questionId;
            obj.tsCreate = global_data.tsCreate;

          }
          else {
            api_url = '/question/create';
          }
          $.ajax({
            method: "POST",
            url: api_url,
            headers: { "Content-Type": "application/json" },
            data: JSON.stringify(obj),
            success: function (data) {
              $('.kb-container-loading').hide();
              $('.tameru-create-header').css({
                'opacity': '1'
              });
              $('.loading').css({
                'opacity': '1'
              })
              var data = JSON.parse(data);
              if (data["result"] == "ok") {
                status_show("ok");
              }
              if (data["result"] != "ok") {
                status_show("failed")
              }
            }
          })
        } else {

          $(".add-tameru-create-btn").prop("disabled", false);
          $('.kb-container-loading').hide();
          $('.tameru-create-header').css({
            'opacity': '1'
          });
          $('.loading').css({
            'opacity': '1'
          })
          error();
        }

      })
      function status_show(status) {
        if (status == "ok") {
          $("body").append("<div class='status-container success'><p class='px-2'>内容を保存しました</p></div>");

        }
        else {
          $("body").append("<div class='status-container fail'><p class='px-2'>内容の保存に失敗しました</p></div>");
        }
        setTimeout(() => {
          $(".status-container").remove();
          if (status == 'ok')
            window.onbeforeunload = null;  // 関数を削除
          window.location.href = "/question";
        }, 2000)
        $(".status-container").css({
          position: "fixed",
          top: "80px",
          width: $(".kb-container").outerWidth(),
          marginLeft: $(".kb-container").css("margin-left"),
          zIndex: 2,
          left: '0'
        })
        $(".status-container.success").css({
          background: "#4caf50"
        })
        $(".status-container.fail").css({
          background: "#fef3f2"
        })
      }
    })
    $('.kb-container').on('scroll', function () {
      var scrollY = $(window).scrollTop();
      var createWrapPos = $('.tameru-create-area-wrap').offset().top;
      var headerH = $('.kb-header').outerHeight();
      $('.tameru-create-area').css('width', $('.tameru-create-area-wrap').outerWidth());
      if ((scrollY + headerH + 20) > createWrapPos) {
        $('.tameru-create-area').css('position', 'fixed');
        $('.tameru-create-area').css('top', headerH + 20);
      } else {
        $('.tameru-create-area').css('position', 'static');
        $('.tameru-create-area').css('top', 0);
      }
    });

    $(function () {
      // var $textarea = $(');
      // var lineHeight = parseInt($textarea.css('lineHeight'));
      $(document).on('input', 'input.form-data-ans', function (e) {
        var lineHeight = parseInt($(this).css('lineHeight'));
        var lines = ($(this).val() + '\n').match(/\n/g).length;
        $(this).height(lineHeight * lines);
      });
    });
    window.onbeforeunload = function (e) {
      return 'このページを離れると、入力したデータが削除されます。移動してもよろしいですか？';
    }
  </script>
  <div class="modal" id="attention" style="display: none;">
    <div class="flex flex-item-center">
      <div class="modal-dialog">
        <div class="kb-panel">
          <div class="kb-panel-title p-3">
            <p class="m-0">この課題を削除してもよろしいですか?</p>
            <i class="fas fa-times modal-close" data-modal="#edit-member-modal"></i>
          </div>
          <div class="kb-panel-body px-3">
            <p>
              <small class="text-muted">※一度削除を行うと元に戻すことができません。</small>
            </p>
            <div class="flex flex-c py-3">
              <a class="btn-tran btn-tran-modal tameru_delete--cancel mx-2">キャンセル</a>
              <button class="submit-btn mx-2 tameru_delete--confirm"> 削除する </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
{% include './ver2.1/partials/footer.html' %}
<script>
  $(document).ready(function () {
    //   $(document).on("click",".contact",function(e){
    //     e.preventDefault();
    //     if(localStorage.getItem("ud") && localStorage.getItem("ud")!="")
    //       window.location.href='/contact/';
    //     else {
    //       window.open('/contact/unlogin', '_blank')
    //     }
    //   })
    //   $(document).on("click", ".policy", function (e) {
    //     e.preventDefault();
    //     if (localStorage.getItem("ud") && localStorage.getItem("ud") != "")
    //       window.location.href = '/policy/';
    //     else {
    //       window.open('/policy/unlogin', '_blank')
    //     }
    //   })
    //   $(document).on("click", ".mobile-logo-link", function (e) {
    //     e.preventDefault();
    //     if (localStorage.getItem("ud") && localStorage.getItem("ud") != "")
    //       window.location.href = '/home';
    //     else {
    //       window.location.href = '/introduction';
    //     }
    //   })
    // })
    // if (localStorage.getItem("ud") && localStorage.getItem("ud") != "")
    //   $(".kb-logo").prepend('<a href="/home"><img src="/static/ver2.1/img/logo__idealump.png" class="logo" alt="" /></a>');
    // else {
    //   $(".kb-logo").prepend('<a href="/introduction"><img src="/static/ver2.1/lp/img/logo.svg" class="logo" alt="" /></a>');
    // }
    // $(".kb-logo:not(.split)").prepend('<a href="/home"><img src="/static/ver2.1/img/logo__idealump.png" class="logo" alt="" /></a>');
  });
</script>

</html>
